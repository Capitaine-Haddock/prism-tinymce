/**
 * Prism plugin by Metrakit
 * contact@jordane.net
*/
tinymce.PluginManager.add('prism', function(editor, url) {
    
    var languageList = [
        'Markup',
        'CSS',
        'Javascript',
        'PHP',
        'CoffeeScript',
        'Sass',
        'Bash',
        'SQL',
        'HTTP',
        'Ruby',
        'Ini',
        'Apache',
        'Git',
        'Less',
        'Markdown'
    ];

    var menuLanguages = [];
    tinymce.each(languageList, function(language) {
        menuLanguages.push({
            text: language,
            value: language.toLowerCase()
        });
    });

    editor.addButton('prism', {
        icon: "code",
        onclick: function() {

            editor.windowManager.open({
                title: 'Insert your code',
                width: 600,
                height: 400,                
                body: [
                    {
                        type: 'listbox',
                        name: 'language',
                        label: 'Language :',
                        'values': menuLanguages
                    },
                    {
                        type   : 'checkbox',
                        name   : 'lineNbr',
                        label  : 'Line number',
                        checked : true
                    },
                    {
                        type: 'TextBox', 
                        name: 'code', 
                        label: 'Code :',
                        multiline: true,
                        minHeight: 300
                        //rows: 10
                    }
                ],
                onsubmit: function(e) {
                    if(e.data.lineNbr === true) {
                        editor.insertContent('<pre class="line-numbers language-' + e.data.language + '"><code>' + e.data.code + '</code></pre><br />');
                    }else{
                        editor.insertContent('<pre class="language-' + e.data.language + '"><code>' + e.data.code + '</code></pre><br />');
                    }
                }
            });
        }
    });

});
